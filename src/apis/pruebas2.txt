

import ReactMapGL from 'react-map-gl';

import { getMap } from '../apis/openMapBox';
import { useSelector } from 'react-redux';

const MapBox = () => {
  // const api = `https://api.mapbox.com/{endpoint}?access_token={your_access_token}`;
  const { city } = useSelector(store => store.selectedCoord);
  console.log('SELECTED COORD REDUX', city);
 
  const [coordsLat, setCoordsLat] = useState(-74.08083)
  const [coordsLon, setCoordsLon] = useState(4.59889)

  let [viewport, setViewport] = useState({
      latitude: -24.08083,
      longitude: 4.59889,
      width:'100vw',
      height:'100vh',
      pitch: 60, // pitch in degrees
      bearing: -60, // bearing in degrees,
      container: 'map',
  })

  useEffect(() => {
    printMap();
  },[city])
 
  const printMap = async () => {
        if(!city){
          const mapa = await getMap('Bogota');
          console.log(mapa.data.features[0].center, '!MAPA = BOGOTA');
    
        } else {
          const mapa = await getMap(city);
          console.log(mapa.data.features[0].center, 'mapa NUEVO DESDE MAP');
          console.log(mapa.data.features[0].center[0], 'Latitud NUEVO DESDE MAP');
          console.log(mapa.data.features[0].center[1], 'Longitud NUEVO DESDE MAP');
          
          setCoordsLat(mapa.data.features[0].center[0]);
          setCoordsLon(mapa.data.features[0].center[1]);
        }
      }
 

  return (
        // <ConditionalRender />
        <ReactMapGL 
        {...viewport}
        zoom={5}
        mapboxAccessToken={'pk.eyJ1Ijoiam9zZWRib2xpdmFybWFmcm9udGVuZDgyIiwiYSI6ImNsMmgzaWJ0dzAwbHYzZHA4aGJmMnUxZ2UifQ.XOgUTl_zAT-vlW1nYOy7gA'}
        mapStyle={'mapbox://styles/mapbox/dark-v10'}
        // hash={true}
        controller={true}
        onViewportChange={(newView) => {
          console.log(newView, 'newVIEW onViewportChange')
          setViewport({
            ...newView,
            latitude: coordsLat,
            longitude: coordsLon
          })
        }}
        ></ReactMapGL>
  )
}

export default MapBox